<?php
$currentDir       = 'Executables';
$body_text        = '';

// Process Form
if (isset($_GET['file']) && isset($_GET['arguments'])) {
    $shouldOutputHTML = false;
    $selectedFile     = $_GET['file'];
    $arguments        = $_GET['arguments'];
    $getRequest       = '/command' . $selectedFile . ' ' . $arguments;

    echo $getRequest;
    exit;
}

// Handle output
$body_text =nl2br(htmlspecialchars($argv[1] ?? ''));
$items     = scandir($currentDir);
$listItems = '';

foreach ($items as $item) {
    if ($item === '.' || $item === '..') {
        continue;
    }
    if (file_exists($currentDir . '/' . $item)) {
        $itemName = pathinfo($item, PATHINFO_FILENAME);
        $listItems .= '<li><a href="#" onclick="`selectFile`("' . $item . '")">' . $itemName . '</a></li>';
    }
}

// Return HTML
echo <<<BODY
<!DOCTYPE html>
<html lang='en'>
<head>
<link rel="stylesheet" href="style/web/hack.css">
<link rel="stylesheet" href="style/main.css">
<meta charset='UTF-8'>
<title>Choose a program:</title>
</head>
<body>
<h2>Programs</h2>
<ul>
$listItems
</ul>

<form id='fileForm' method='get'>
<input type='hidden' id='selectedFile' name='file'>
<label for='arguments'>Arguments:</label><br>
<input type='text' id='arguments' name='arguments'><br><br>
<input type='submit' value='Submit'>
</form>

<script>
const selectFile = () => {
     document.getElementById('selectedFile').value = file;
};
</script>

<h2>Program Output {\n</h2>
<pre>" . $body_text . "</pre>
<h2>\n}</h2>
<h2>----------------------------</h2>

<h2>Browse Files\n</h2>
<a href='browse_files.php'>Browse Files\n</a>

<h2>----------------------------</h2>

</body>
</html>
BODY;
